<sky-demo-nav></sky-demo-nav>

<stache pageTitle="Component libraries" showTableOfContents="true">
  <stache-page-summary>
    After you create components with SKY UX, you can organize them into libraries to publish them for other SPAs to consume. This reference describes how to create reusable component libraries for SKY UX.
  </stache-page-summary>

<!--
  <stache-page-anchor>
    Overview
  </stache-page-anchor>
-->

  <stache-page-anchor>
    Install dependencies
  </stache-page-anchor>

  <p>
    The first step to author a SKY UX component library is to create a SPA and specify the base template that includes the starter module for creating component libraries. To do this, run <stache-code>skyux new</stache-code> from the SKY UX CLI and use the <stache-code>--template</stache-code> option to specify the <stache-code>library</stache-code> template.
  </p>

  <stache-code-block>
    skyux new --template library
  </stache-code-block>

  <stache-page-anchor>
    Create the components for the library
  </stache-page-anchor>
  
  <p>
    The library template places source files in <stache-code>/src/app/public</stache-code>. SKY UX Builder ignores any components in this folder, so they are not automatically declared in <stache-code>SkyModule</stache-code>. This allows you to write Angular modules, components, and services outside of SKY UX's scope.
  </p>

  <p>
    The entry point for your component library is <stache-code>/src/app/public/index.ts</stache-code>. This file is responsible for exporting any code you want to make available to the bundler.
  </p>

  <stache-page-anchor>
    Bundle the library
  </stache-page-anchor>
  
  <p>
    After you create a SPA and the components for the library, the next step is to bundle the components into a consumable NPM module that you can publish to an NPM stream such as <a href="https://www.npmjs.com/">npmjs.org</a>. To do this, run <stache-code>skyux build-public-library</stache-code> from the SKY UX CLI.
  </p>

  <stache-code-block>
    skyux build-public-library
  </stache-code-block>

  <p>
    This command creates a bundle that is NPM-ready and places it in a <strong>/dist</strong> directory. It bundles the components in the <stache-code>/src/app/public</stache-code> folder and ignores all other files. Keep in mind that this  command does not publish the component library.
  </p>

  <stache-page-anchor>
    Publish the library
  </stache-page-anchor>

  <p>
    After you bundle SKY UX components into a consumable NPM module, you can publish it to an NPM stream to allow other SPAs to install the library. For public libraries, we recommend that you publish to <a href="https://www.npmjs.com/">npmjs.org</a>.
    your SPA and the components for yoru library, the next step is to bundle your components into a consumable NPM module that can be published to an NPM stream such as <a href="https://www.npmjs.com/">npmjs.org</a>. To do this, run <stache-code>skyux build-public-library</stache-code> from the SKY UX CLI.
  </p>

  <p>
    (Add notes here about NPM feeds for both public and private libraries.)
  </p>

  <h3>
    Method 1: Publish to Blackbaud's NPM stream (internal-only)
  </h3>

  <p>
    For internal-only component libraries, you'll need to register your SPA through the appropriate VSTS pipeline. Reach out to Jonathan Bell for more information.
  </p>

  <h3>
    Method 2: Publish to npmjs.org (public)
  </h3>

  <p>
    Publishing to npmjs.org is done via Travis-CI, and free GitHub continuous integration service. If you wish to publish your library in the <stache-code>@blackbaud/*</stache-code> namespace, reach out to someone on the SKY UX team to get the Travis-CI account created and setup. Otherwise, you'll need to write some custom commands to have Travis-CI automatically publish your bundle to npmjs.org (See <a href="https://docs.travis-ci.com/user/deployment/npm/">Releasing to NPM with Travis-CI</a>, for more information).
  </p>

  <stache-page-anchor>
    Consume the library in another SPA
  </stache-page-anchor>

  <p>
    <strong>/app/src/app-extras.module.ts</strong>
  </p>
  <stache-code-block languageType="typescript">
    import { NgModule } from '@angular/core';

    import { LibraryModule } from 'my-component-library';

    @NgModule({
      imports: [
        LibraryModule
      ],
      exports: [
        LibraryModule
      ]
    })
    export class AppExtrasModule { }
  </stache-code-block>

  <stache-page-anchor>
    Access the consuming app's configuration
  </stache-page-anchor>

  <p>
    (Provide reasons for why SkyAppConfig cannot be accessed by the component library. Why we need to create the adaptor, etc.)
  </p>
  <p>
    Since the source files found in <strong>@blackbaud/skyux-builder/runtime</strong> (such as <stache-code>SkyAppConfig</stache-code>) are not transpiled as a <a href="http://davidbcalhoun.com/2014/what-is-amd-commonjs-and-umd/">UMD module</a>--and thus cannot be <a href="https://www.npmjs.com/package/codelyzer">analyzed statically</a>--we cannot directly reference these files in our component library (since it will eventually become a UMD module). Instead, we must create an adaptor class (in the consuming SPA) that can be provided the transpiled version of <stache-code>SkyAppConfig</stache-code> at runtime.
  </p>

  <p>
    The following code sample demonstrates how to create the adaptor in the consuming SPA.
  </p>

  <p>
    <strong>/app/src/app-extras.module.ts</strong>
  </p>

  <stache-code-block languageType="typescript">
    import { NgModule } from '@angular/core';

    import { SkyAppConfig } from '@blackbaud/skyux-builder/runtime';

    import { LibraryModule, LibraryConfigService } from 'my-component-library';

    @NgModule({
      imports: [
        LibraryModule
      ],
      exports: [
        LibraryModule
      ],
      providers: [
        // The config service acts as an adaptor for skyuxconfig.json:
        {
          provide: LibraryConfigService,
          useExisting: SkyAppConfig
        }
      ]
    })
    export class AppExtrasModule { }
  </stache-code-block>

  <stache-page-anchor>
    Provide configuration for the library
  </stache-page-anchor>

  <p>
    (This step depends on the previous step.)
  </p>

  <p>
    Add any properties you wish to <stache-code>"appSettings"</stache-code>.
  </p>

  <p>
    <strong>/skyuxconfig.json</strong>
  </p>

  <stache-code-block languageType="json">
    {
      "appSettings": {
        "myLibrary": {
          "foo": "bar",
          "baz": true
        }
      }
    }
  </stache-code-block>

  <p>
    You may then access these properties in your components by injecting the <stache-code>LibraryConfigService</stache-code>.
  </p>

  <p>
    <strong>/app/src/public/src/modules/shared/config.service.ts</strong>
  </p>

  <stache-code-block languageType="typescript">
    import { LibraryConfigService } from '../shared';

    @Component({ ... })
    export class MyLibraryComponent {
      constructor(public configService: LibraryConfigService) {
        console.log(configService.appSettings.myLibrary.foo); // "bar"
      }
    }

  </stache-code-block>
</stache>
